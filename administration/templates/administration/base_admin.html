{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 pt-20">
    <div class="flex">
        <!-- Sidebar -->
        <aside
            class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 min-h-screen fixed left-0 top-20 bottom-0 overflow-y-auto z-40 hidden md:block">
            <div class="p-6">
                <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">Administration</h2>
                <nav class="space-y-2">
                    <a href="{% url 'administration:dashboard' %}"
                        class="flex items-center px-4 py-2 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'dashboard' %}bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}">
                        <i class="bi bi-speedometer2 mr-3"></i>
                        Dashboard
                    </a>

                    <div class="pt-4 pb-2">
                        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Management</h3>
                    </div>

                    <a href="{% url 'administration:user_list' %}"
                        class="flex items-center px-4 py-2 text-sm font-medium rounded-lg {% if 'users' in request.path %}bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}">
                        <i class="bi bi-people mr-3"></i>
                        Users
                    </a>

                    <a href="{% url 'administration:tip_list' %}"
                        class="flex items-center px-4 py-2 text-sm font-medium rounded-lg {% if 'tips' in request.path %}bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}">
                        <i class="bi bi-lightbulb mr-3"></i>
                        Tips
                    </a>

                    <a href="{% url 'administration:category_list' %}"
                        class="flex items-center px-4 py-2 text-sm font-medium rounded-lg {% if 'categories' in request.path %}bg-purple-50 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}">
                        <i class="bi bi-tags mr-3"></i>
                        Categories
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 md:ml-64 p-8">
            {% if messages %}
            <div class="mb-6 space-y-2">
                {% for message in messages %}
                <div
                    class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% else %}bg-blue-50 text-blue-700 border border-blue-200{% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% block admin_content %}{% endblock %}
        </main>
        <!-- Confirmation Modal -->
        <div id="confirmationModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title"
            role="dialog" aria-modal="true">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div
                    class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div
                                class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-amber-100 sm:mx-0 sm:h-10 sm:w-10">
                                <i class="bi bi-exclamation-triangle text-amber-600 text-lg"></i>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white"
                                    id="modal-title">
                                    Confirm Action
                                </h3>
                                <div class="mt-2">
                                    <p class="text-sm text-gray-500 dark:text-gray-400" id="modal-message">
                                        Are you sure you want to proceed?
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="confirmBtn"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-emerald-600 text-base font-medium text-white hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Confirm
                        </button>
                        <button type="button" id="cancelBtn"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script>
            // Modal Logic
            const modal = document.getElementById('confirmationModal');
            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const modalMessage = document.getElementById('modal-message');
            let confirmCallback = null;
            let cancelCallback = null;

            function showConfirmation(message, onConfirm, onCancel) {
                modalMessage.textContent = message;
                confirmCallback = onConfirm;
                cancelCallback = onCancel;
                modal.classList.remove('hidden');
            }

            function hideModal() {
                modal.classList.add('hidden');
                confirmCallback = null;
                cancelCallback = null;
            }

            confirmBtn.addEventListener('click', () => {
                if (confirmCallback) confirmCallback();
                hideModal();
            });

            cancelBtn.addEventListener('click', () => {
                if (cancelCallback) cancelCallback();
                hideModal();
            });

            // CSRF Token Helper
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');
        </script>
    </div>
</div>
{% endblock %}